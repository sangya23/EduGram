<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edu-Gram - Welcome</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="common-style.css">
    <link rel="stylesheet" href="istyle.css">
    <link rel="stylesheet" href="aichatbot.css" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
</head>
<body>
    <div class="modal-overlay" id="modalOverlay" onclick="closeModalOnOverlay(event)">
        <div class="modal" id="modal" onclick="event.stopPropagation()">
            <div class="modal-header" id="modalHeader">
                <i class="modal-icon" id="modalIcon"></i>
                <h2 class="modal-title" id="modalTitle"></h2>
            </div>
            <div class="modal-body">
                <div id="modalContent"></div>
            </div>
        </div>
    </div>

    <div class="container" id="loginContainer">
        <div class="welcome-panel">
            <h1>Edu-Gram</h1>
        </div>

        <div class="form-panel">
            <div class="tab-buttons">
                <button class="tab-btn active" id="loginTab" onclick="showTab('login')">Log In</button>
                <button class="tab-btn" id="signupTab" onclick="showTab('signup')">Sign Up</button>
            </div>

            <div class="form-container active" id="loginForm">
                <div class="form-header">
                    <h2>Welcome Back! üëã</h2>
                    <p>Log in to continue...</p>
                </div>
                
                <button class="google-btn" onclick="handleGoogleSignIn()">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Continue with Google
                </button>

                <div class="divider">
                    <span>OR</span>
                </div>

                <form onsubmit="handleLogin(event)">
                    <div class="form-group">
                        <label for="loginEmail">Email</label>
                        <div class="input-wrapper">
                            <input type="email" id="loginEmail" placeholder="Enter your email" required>
                            <i class="fa-regular fa-envelope input-icon"></i>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <div class="input-wrapper">
                            <input type="password" id="loginPassword" placeholder="Enter your password" required>
                            <i class="fa-regular fa-eye password-toggle" onclick="togglePassword('loginPassword', this)"></i>
                        </div>
                    </div>
                    <div class="forgot-password">
                        <a href="forgot-password.php" >Forgot Password?</a>
                    </div>
                    <button type="submit" class="btn">Log In</button>
                </form>
            </div>

            <div class="form-container" id="signupForm">
                <div class="form-header">
                    <h2>Create Account</h2>
                </div>

                <button class="google-btn" onclick="handleGoogleSignIn()">
                    <svg class="google-icon" viewBox="0 0 24 24">
                        <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
                        <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
                        <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
                        <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
                    </svg>
                    Sign up with Google
                </button>

                <div class="divider">
                    <span>OR</span>
                </div>

                <form onsubmit="handleSignup(event)">
                    <div class="form-group">
                    <label for="signupName">Full Name</label>
                        <div class="input-wrapper">
                            <input type="text" id="signupName" placeholder="Enter your full name" required oninput="validateNameRealtime(this)">
                            <i class="fa-regular fa-user input-icon"></i>
                        </div>
                        <div class="name-validation-message" id="nameValidationMessage"></div>
                    </div>
                    <div class="form-group">
                        <label for="signupEmail">Email</label>
                        <div class="input-wrapper">
                            <input type="email" id="signupEmail" placeholder="Enter your email" required oninput="validateEmailRealtime(this)">
                            <i class="fa-regular fa-envelope input-icon"></i>
                        </div>
                        <div class="email-validation-message" id="emailValidationMessage"></div>
                        <div class="email-suggestion" id="emailSuggestion"></div>
                    </div>
                    <div class="form-group">
                        <label for="signupPassword">Password</label>
                        <div class="input-wrapper">
                            <input type="password" id="signupPassword" placeholder="Create a strong password" required oninput="validatePassword()">
                            <i class="fa-regular fa-eye password-toggle" onclick="togglePassword('signupPassword', this)"></i>
                        </div>
                        <div class="password-requirements" id="passwordRequirements">
                            ‚ö†Ô∏è Password must contain: at least 8 characters, one uppercase, one lowercase, one number, and one special character
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="signupConfirmPassword">Confirm Password</label>
                        <div class="input-wrapper">
                            <input type="password" id="signupConfirmPassword" placeholder="Confirm your password" required oninput="checkPasswordMatch()">
                            <i class="fa-regular fa-eye password-toggle" onclick="togglePassword('signupConfirmPassword', this)"></i>
                        </div>
                        <div class="password-match-error" id="passwordMatchError">
                            ‚ùå Passwords do not match
                        </div>
                        <div class="password-match-success" id="passwordMatchSuccess">
                            ‚úÖ Passwords match
                        </div>
                    </div>
                    <button type="submit" class="btn">Sign Up</button>
                </form>

                <div class="terms-text">
                    By signing up, you agree to our  
                    <a href="termsofservice.html" target="_blank">Terms of Service</a> and <a href="privacypolicy.html" target="_blank">Privacy Policy</a>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container" id="dashboardContainer">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1>Edu-Gram</h1>
            </div>
            <!-- Replace the navigation section in your index.html with this: -->
            <nav class="sidebar-nav">
                <div class="nav-item active" onclick="switchPage('home')">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </div>
                <div class="nav-item" onclick="window.location.href='Assignment.php'">
                    <i class="fas fa-tasks"></i>
                    <span>Assignments</span>
                </div>
                <div class="nav-item" onclick="window.location.href='exam_list.php'">
                    <i class="fas fa-graduation-cap"></i>
                    <span>Exams</span>
                </div>
                <div class="nav-item" onclick="window.location.href='Techniques.php'">
                    <i class="fas fa-lightbulb"></i>
                    <span>Techniques</span>
                </div>
                <div class="nav-item" onclick="window.location.href='pomodoroindex.php'">
                    <i class="fas fa-clock"></i>
                    <span>Pomodoro Timer</span>
                </div>
                <div class="nav-item" onclick="window.location.href='to-dolist.php'">
                    <i class="fas fa-list-check"></i>
                    <span>To-Do List</span>
                </div>
                <div class="nav-item" onclick="window.location.href='help.php'">
                    <i class="fas fa-question-circle"></i>
                    <span>Help</span>
                </div>
            </nav>
        </aside>
        <main class="main-content">
            <header class="top-bar">
    <div class="user-info">
        <div class="user-menu-trigger" onclick="toggleUserDropdown()">
            <div class="user-avatar">
                <i class="fas fa-user"></i>
            </div>
            <div class="user-details">
                <span class="name" id="userName">User</span>
                <span class="email" id="userEmail">user@email.com</span>
            </div>
            <i class="fas fa-chevron-down"></i>
        </div>
        <div class="user-dropdown" id="userDropdown">
            <div class="dropdown-item" onclick="switchPage('profile')">
                <i class="fas fa-user"></i>
                <span>Profile</span>
            </div>
            <div class="dropdown-item logout" onclick="handleLogout()">
                <i class="fas fa-sign-out-alt"></i>
                <span>Logout</span>
            </div>
        </div>
    </div>
</header>
            <div class="content-area" id="contentArea">
            </div>
        </main>
    </div>
    
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script>
        let currentUser = null;
        let pendingVerification = null;
        let verificationCode = '';
        let resetEmail = '';
        let isEmailValid = false;

        const commonDomains = [
            'gmail.com', 'yahoo.com', 'outlook.com', 'hotmail.com',
            'icloud.com', 'protonmail.com', 'aol.com', 'mail.com',
            'zoho.com', 'yandex.com', 'gmx.com'
        ];

        const disposableDomains = [
            'tempmail.com', '10minutemail.com', 'guerrillamail.com',
            'mailinator.com', 'trashmail.com', 'throwaway.email',
            'temp-mail.org', 'fakeinbox.com', 'maildrop.cc'
        ];

        const motivationalQuotes = [
            { text: "Success is not final, failure is not fatal: it is the courage to continue that counts.", author: "Winston Churchill" },
            { text: "The expert in anything was once a beginner.", author: "Helen Hayes" },
            { text: "Education is the passport to the future, for tomorrow belongs to those who prepare for it today.", author: "Malcolm X" },
            { text: "You don't have to be great to start, but you have to start to be great.", author:"Zig Ziglar"},
            { text: "An investment in knowledge pays the best interest.", author: "Benjamin Franklin" },
            { text: "Success is the sum of small efforts, repeated day in and day out.", author: "Robert Collier" },
            { text: "The future belongs to those who believe in the beauty of their dreams.", author: "Eleanor Roosevelt" },
            { text: "It always seems impossible until it's done.", author: "Nelson Mandela" },
            { text: "Believe you can and you're halfway there.", author: "Theodore Roosevelt" },
            { text: "The only way to do great work is to love what you do.", author: "Steve Jobs" },
            { text: "Success is the sum of small efforts repeated day in and day out.", author: "Robert Collier" },
            { text: "Don't let what you cannot do interfere with what you can do.", author: "John Wooden" },
            { text: "The difference between ordinary and extraordinary is that little extra.", author: "Jimmy Johnson" },
            { text: "Start where you are. Use what you have. Do what you can.", author: "Arthur Ashe" },
            { text: "Your education is a dress rehearsal for a life that is yours to lead.", author: "Nora Ephron" },
            { text: "Start where you are. Use what you have. Do what you can.", author: "Arthur Ashe" },
            { text: "A little progress each day adds up to big results.", author: "Satya Nani" },
            { text: "Our greatest weakness lies in giving up. The most certain way to succeed is always to try just one more time.", author: "Thomas Edison" },
            { text: "Do something today that your future self will thank you for.", author: "Sean Patrick Flanery" },
            { text: "Striving for success without hard work is like trying to harvest when you haven't planted.", author: "David Bly" },
            { text: "Education is not preparation for life; education is life itself.", author: "John Dewey" },
            { text: "The beautiful thing about learning is that no one can take it away from you.", author: "B.B. King" },
            { text: "Learning is not attained by chance, it must be sought for with ardor and diligence.", author: "Abigail Adams" },
            { text: "The capacity to learn is a gift; the ability to learn is a skill; the willingness to learn is a choice.", author: "Brian Herbert" }
        ];

        let currentQuote = 0;

        function getRandomQuote() {
            currentQuote = Math.floor(Math.random() * motivationalQuotes.length);
            return motivationalQuotes[currentQuote];
        }

        function displayQuote() {
            const quote = getRandomQuote();
            const quoteContainer = document.querySelector('.quote-text');
            const authorContainer = document.querySelector('.quote-author');
            
            if (quoteContainer && authorContainer) {
                quoteContainer.style.opacity = '0';
                authorContainer.style.opacity = '0';
                
                setTimeout(() => {
                    quoteContainer.textContent = quote.text;
                    authorContainer.textContent = '‚Äî ' + quote.author;
                    quoteContainer.style.transition = 'opacity 0.5s ease';
                    authorContainer.style.transition = 'opacity 0.5s ease';
                    quoteContainer.style.opacity = '1';
                    authorContainer.style.opacity = '1';
                }, 200);
            }
        }

        function validateEmailRealtime(input) {
            const email = input.value.trim().toLowerCase();
            const messageDiv = document.getElementById('emailValidationMessage');
            const suggestionDiv = document.getElementById('emailSuggestion');
            
            messageDiv.className = 'email-validation-message';
            suggestionDiv.className = 'email-suggestion';
            suggestionDiv.innerHTML = '';
            isEmailValid = false;

            if (!email) {
                input.classList.remove('error', 'success');
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'email-validation-message error';
                messageDiv.innerHTML = '‚ùå Please enter a valid email format (e.g., user@example.com)';
                return;
            }

            const domain = email.split('@')[1];
            const username = email.split('@')[0];

            if (username.length < 3) {
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'email-validation-message error';
                messageDiv.innerHTML = '‚ùå Email username must be at least 3 characters';
                return;
            }

            if (disposableDomains.some(d => domain.includes(d))) {
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'email-validation-message error';
                messageDiv.innerHTML = '‚ùå Temporary/disposable email addresses are not allowed';
                return;
            }

            const suggestion = suggestEmailCorrection(domain);
            if (suggestion && suggestion !== domain) {
                input.classList.remove('error', 'success');
                messageDiv.className = 'email-validation-message warning';
                messageDiv.innerHTML = '‚ö†Ô∏è Did you mean <strong>' + suggestion + '</strong>?';
                
                suggestionDiv.className = 'email-suggestion show';
                suggestionDiv.innerHTML = `üí° Click to use: <strong>${username}@${suggestion}</strong>`;
                suggestionDiv.onclick = () => {
                    input.value = `${username}@${suggestion}`;
                    validateEmailRealtime(input);
                };
                return;
            }

            if (commonDomains.includes(domain)) {
                input.classList.remove('error');
                input.classList.add('success');
                messageDiv.className = 'email-validation-message success';
                messageDiv.innerHTML = '‚úÖ Email format looks good!';
                isEmailValid = true;
                return;
            }

            const tldRegex = /^[^\s@]+@[^\s@]+\.(com|org|net|edu|gov|mil|co|io|app|dev|ai|tech|info|biz|me)$/i;
            if (tldRegex.test(email)) {
                input.classList.remove('error');
                input.classList.add('success');
                messageDiv.className = 'email-validation-message success';
                messageDiv.innerHTML = '‚úÖ Email format is valid';
                isEmailValid = true;
            } else {
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'email-validation-message error';
                messageDiv.innerHTML = '‚ùå Please check the email domain (e.g., .com, .org, .net)';
            }
        }

        function suggestEmailCorrection(domain) {
            const typoMap = {
                'gmial.com': 'gmail.com',
                'gmai.com': 'gmail.com',
                'gmil.com': 'gmail.com',
                'gmal.com': 'gmail.com',
                'gamil.com': 'gmail.com',
                'gnail.com': 'gmail.com',
                'yahooo.com': 'yahoo.com',
                'yaho.com': 'yahoo.com',
                'yhoo.com': 'yahoo.com',
                'outlok.com': 'outlook.com',
                'outloo.com': 'outlook.com',
                'hotmial.com': 'hotmail.com',
                'hotmil.com': 'hotmail.com',
                'hotnail.com': 'hotmail.com',
                'iclould.com': 'icloud.com',
                'icoud.com': 'icloud.com'
            };

            if (typoMap[domain]) {
                return typoMap[domain];
            }

            for (const commonDomain of commonDomains) {
                if (calculateSimilarity(domain, commonDomain) > 0.7) {
                    return commonDomain;
                }
            }

            return null;
        }

        function calculateSimilarity(str1, str2) {
            const longer = str1.length > str2.length ? str1 : str2;
            const shorter = str1.length > str2.length ? str2 : str1;
            
            if (longer.length === 0) return 1.0;
            
            const editDistance = getEditDistance(longer, shorter);
            return (longer.length - editDistance) / longer.length;
        }

        function validateNameRealtime(input) {
            const name = input.value;
            const messageDiv = document.getElementById('nameValidationMessage');
            
            
            const nameRegex = /^[a-zA-Z\s]*$/;
            if (!nameRegex.test(name)) {
                input.value = name.replace(/[^a-zA-Z\s]/g, '');
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'name-validation-message error';
                messageDiv.textContent = '‚ùå Name should contain only letters and spaces';
                return;
            }
            
           
            if (!name.trim()) {
                input.classList.remove('error', 'success');
                messageDiv.className = 'name-validation-message';
                return;
            }
            
            
            const validNameRegex = /^[a-zA-Z]+(\s[a-zA-Z]+)*$/;
            if (name.trim().length < 2) {
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'name-validation-message error';
                messageDiv.textContent = '‚ùå Name must be at least 2 characters long';
            } else if (!validNameRegex.test(name.trim())) {
                input.classList.add('error');
                input.classList.remove('success');
                messageDiv.className = 'name-validation-message error';
                messageDiv.textContent = '‚ùå Please enter a valid name format';
            } else {
                input.classList.remove('error');
                input.classList.add('success');
                messageDiv.className = 'name-validation-message success';
                messageDiv.textContent = '‚úÖ Name looks good!';
            }
        }

        function getEditDistance(str1, str2) {
            const matrix = [];
            
            for (let i = 0; i <= str2.length; i++) {
                matrix[i] = [i];
            }
            
            for (let j = 0; j <= str1.length; j++) {
                matrix[0][j] = j;
            }
            
            for (let i = 1; i <= str2.length; i++) {
                for (let j = 1; j <= str1.length; j++) {
                    if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
                        matrix[i][j] = matrix[i - 1][j - 1];
                    } else {
                        matrix[i][j] = Math.min(
                            matrix[i - 1][j - 1] + 1,
                            matrix[i][j - 1] + 1,
                            matrix[i - 1][j] + 1
                        );
                    }
                }
            }
            
            return matrix[str2.length][str1.length];
        }

        function initGoogleSignIn() {
            
            console.log('Google Sign-In initialized');
        }

        /*function handleGoogleCallback(response) {
            try {
                const payload = JSON.parse(atob(response.credential.split('.')[1]));
                
                const user = {
                    name: payload.name,
                    email: payload.email,
                    picture: payload.picture,
                    googleId: payload.sub,
                    verified: true
                };

                showModal('success', 'Success!', `Welcome ${user.name}! You've successfully signed in with Google.`, [
                    {
                        text: 'Continue',
                        class: 'modal-btn-primary',
                        action: () => {
                            closeModal();
                            showDashboard(user);
                        }
                    }
                ]);
            } catch (error) {
                showModal('error', 'Error', 'Failed to sign in with Google. Please try again.');
            }
        }*/

        function handleGoogleSignIn() {
            
            window.location.href = 'https://accounts.google.com/o/oauth2/v2/auth?' + new URLSearchParams({
                client_id: '1090943248108-chlg9pcpifafaeg2q1ipdd9hb93kjleq.apps.googleusercontent.com',
                redirect_uri: 'http://localhost/edugram/google-callback.php',
                response_type: 'code',
                scope: 'email profile',
                access_type: 'online',
                prompt: 'select_account'
            });
        }

        function showModal(type, title, message, buttons = null) {
            const modal = document.getElementById('modal');
            const overlay = document.getElementById('modalOverlay');
            const header = document.getElementById('modalHeader');
            const icon = document.getElementById('modalIcon');
            const titleEl = document.getElementById('modalTitle');
            const content = document.getElementById('modalContent');

            header.className = `modal-header ${type}`;
            
            const icons = {
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                success: 'fas fa-check-circle',
                info: 'fas fa-info-circle'
            };
            
            icon.className = `modal-icon ${icons[type] || icons.info}`;
            titleEl.textContent = title;

            let contentHTML = message ? `<p class="modal-message">${message}</p>` : '';
            
            if (buttons) {
                contentHTML += '<div class="modal-buttons">';
                buttons.forEach(btn => {
                    contentHTML += `<button class="modal-btn ${btn.class}" onclick="(${btn.action.toString()})()">${btn.text}</button>`;
                });
                contentHTML += '</div>';
            } else {
                contentHTML += '<div class="modal-buttons"><button class="modal-btn modal-btn-primary" onclick="closeModal()">OK</button></div>';
            }

            content.innerHTML = contentHTML;
            overlay.classList.add('show');
        }

        function closeModal() {
            document.getElementById('modalOverlay').classList.remove('show');
        }

        function closeModalOnOverlay(event) {
            if (event.target.id === 'modalOverlay') {
                closeModal();
            }
        }

        function showForgotPassword() {
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <p class="modal-message">Enter your email address and we'll send you a verification code to reset your password.</p>
                <div class="form-group">
                    <label for="resetEmail">Email Address</label>
                    <div class="input-wrapper">
                        <input type="email" id="resetEmail" placeholder="Enter your email" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" onclick="sendPasswordResetCode()">Send Code</button>
                </div>
            `;
            
            document.getElementById('modalHeader').className = 'modal-header info';
            document.getElementById('modalIcon').className = 'modal-icon fas fa-key';
            document.getElementById('modalTitle').textContent = 'Reset Password';
            document.getElementById('modalOverlay').classList.add('show');
        }

        function sendPasswordResetCode() {
            const email = document.getElementById('resetEmail').value.trim();
            
            if (!email) {
                showModal('error', 'Error', 'Please enter your email address.');
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                showModal('error', 'Invalid Email', 'Please enter a valid email address.');
                return;
            }

            resetEmail = email;
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            
            console.log(`Password Reset Code for ${email}: ${verificationCode}`);
            
            showPasswordResetVerification();
        }

        function showPasswordResetVerification() {
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <p class="modal-message">We've sent a 6-digit verification code to <strong>${resetEmail}</strong>. Please enter it below.</p>
                <p style="font-size: 0.9em; color: #666; margin-bottom: 20px; text-align: center;">Demo: Check console for code</p>
                <div class="verification-input-group">
                    <input type="text" maxlength="1" class="verification-input" id="code1" oninput="moveToNext(this, 'code2')" onkeydown="moveToPrev(event, this, null)">
                    <input type="text" maxlength="1" class="verification-input" id="code2" oninput="moveToNext(this, 'code3')" onkeydown="moveToPrev(event, this, 'code1')">
                    <input type="text" maxlength="1" class="verification-input" id="code3" oninput="moveToNext(this, 'code4')" onkeydown="moveToPrev(event, this, 'code2')">
                    <input type="text" maxlength="1" class="verification-input" id="code4" oninput="moveToNext(this, 'code5')" onkeydown="moveToPrev(event, this, 'code3')">
                    <input type="text" maxlength="1" class="verification-input" id="code5" oninput="moveToNext(this, 'code6')" onkeydown="moveToPrev(event, this, 'code4')">
                    <input type="text" maxlength="1" class="verification-input" id="code6" oninput="moveToNext(this, null)" onkeydown="moveToPrev(event, this, 'code5')">
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="sendPasswordResetCode(); return false;" style="color: #0f3460; text-decoration: none; font-size: 0.9em;">Resend Code</a>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" onclick="verifyPasswordResetCode()">Verify</button>
                </div>
            `;
            
            document.getElementById('modalHeader').className = 'modal-header info';
            document.getElementById('modalIcon').className = 'modal-icon fas fa-shield-alt';
            document.getElementById('modalTitle').textContent = 'Verify Code';
            
            setTimeout(() => document.getElementById('code1').focus(), 100);
        }

        function verifyPasswordResetCode() {
            const code = ['code1', 'code2', 'code3', 'code4', 'code5', 'code6']
                .map(id => document.getElementById(id).value)
                .join('');
            
            if (code.length !== 6) {
                showModal('error', 'Error', 'Please enter the complete 6-digit code.');
                return;
            }

            if (code === verificationCode) {
                showNewPasswordForm();
            } else {
                showModal('error', 'Invalid Code', 'The verification code you entered is incorrect. Please try again.');
            }
        }

        function showNewPasswordForm() {
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <p class="modal-message">Enter your new password</p>
                <div class="form-group">
                    <label for="newPassword">New Password</label>
                    <div class="input-wrapper">
                        <input type="password" id="newPassword" placeholder="Enter new password" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;" oninput="validateNewPassword()">
                    </div>
                    <div class="password-requirements" id="newPasswordRequirements">
                        ‚ö†Ô∏è Password must contain: at least 8 characters, one uppercase, one lowercase, one number, and one special character
                    </div>
                </div>
                <div class="form-group">
                    <label for="confirmNewPassword">Confirm New Password</label>
                    <div class="input-wrapper">
                        <input type="password" id="confirmNewPassword" placeholder="Confirm new password" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;" oninput="checkNewPasswordMatch()">
                    </div>
                    <div class="password-match-error" id="newPasswordMatchError">
                        ‚ùå Passwords do not match
                    </div>
                    <div class="password-match-success" id="newPasswordMatchSuccess">
                        ‚úÖ Passwords match
                    </div>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" onclick="resetPassword()">Reset Password</button>
                </div>
            `;
            
            document.getElementById('modalHeader').className = 'modal-header info';
            document.getElementById('modalIcon').className = 'modal-icon fas fa-lock';
            document.getElementById('modalTitle').textContent = 'New Password';
        }

        function validateNewPassword() {
            const password = document.getElementById('newPassword').value;
            const requirements = document.getElementById('newPasswordRequirements');
            
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            
            if (password.length > 0 && !passwordRegex.test(password)) {
                requirements.classList.add('show');
            } else {
                requirements.classList.remove('show');
            }
            
            checkNewPasswordMatch();
        }

        function checkNewPasswordMatch() {
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;
            const errorDiv = document.getElementById('newPasswordMatchError');
            const successDiv = document.getElementById('newPasswordMatchSuccess');
            
            if (confirmPassword.length === 0) {
                errorDiv.classList.remove('show');
                successDiv.classList.remove('show');
                return;
            }
            
            if (password === confirmPassword) {
                errorDiv.classList.remove('show');
                successDiv.classList.add('show');
            } else {
                successDiv.classList.remove('show');
                errorDiv.classList.add('show');
            }
        }

        function resetPassword() {
            const password = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmNewPassword').value;

            if (!password || !confirmPassword) {
                showModal('error', 'Error', 'Please fill in all fields.');
                return;
            }

            if (password !== confirmPassword) {
                showModal('error', 'Error', 'Passwords do not match.');
                return;
            }

            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            if (!passwordRegex.test(password)) {
                showModal('error', 'Weak Password', 'Password must meet all requirements.');
                return;
            }

            showModal('success', 'Password Reset!', 'Your password has been successfully reset. You can now log in with your new password.', [
                {
                    text: 'Go to Login',
                    class: 'modal-btn-primary',
                    action: () => {
                        closeModal();
                        showTab('login');
                    }
                }
            ]);
        }

        function showEmailVerification(email) {
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log(`Verification code for ${email}: ${verificationCode}`);
            
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <p class="modal-message">We've sent a 6-digit verification code to <strong>${email}</strong>. Please enter it below to verify your account.</p>
                <p style="font-size: 0.9em; color: #666; margin-bottom: 20px; text-align: center;">Demo: Check console for code</p>
                <div class="verification-input-group">
                    <input type="text" maxlength="1" class="verification-input" id="code1" oninput="moveToNext(this, 'code2')" onkeydown="moveToPrev(event, this, null)">
                    <input type="text" maxlength="1" class="verification-input" id="code2" oninput="moveToNext(this, 'code3')" onkeydown="moveToPrev(event, this, 'code1')">
                    <input type="text" maxlength="1" class="verification-input" id="code3" oninput="moveToNext(this, 'code4')" onkeydown="moveToPrev(event, this, 'code2')">
                    <input type="text" maxlength="1" class="verification-input" id="code4" oninput="moveToNext(this, 'code5')" onkeydown="moveToPrev(event, this, 'code3')">
                    <input type="text" maxlength="1" class="verification-input" id="code5" oninput="moveToNext(this, 'code6')" onkeydown="moveToPrev(event, this, 'code4')">
                    <input type="text" maxlength="1" class="verification-input" id="code6" oninput="moveToNext(this, null)" onkeydown="moveToPrev(event, this, 'code5')">
                </div>
                <div style="text-align: center; margin-top: 15px;">
                    <a href="#" onclick="resendVerificationCode(); return false;" style="color: #0f3460; text-decoration: none; font-size: 0.9em;">Resend Code</a>
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" onclick="verifyEmailCode()">Verify</button>
                </div>
            `;
            
            document.getElementById('modalHeader').className = 'modal-header info';
            document.getElementById('modalIcon').className = 'modal-icon fas fa-envelope-open-text';
            document.getElementById('modalTitle').textContent = 'Verify Email';
            document.getElementById('modalOverlay').classList.add('show');
            
            setTimeout(() => document.getElementById('code1').focus(), 100);
        }

        function moveToNext(current, nextId) {
            if (current.value.length === 1 && nextId) {
                document.getElementById(nextId).focus();
            }
        }

        function moveToPrev(event, current, prevId) {
            if (event.key === 'Backspace' && current.value.length === 0 && prevId) {
                document.getElementById(prevId).focus();
            }
        }

        function resendVerificationCode() {
            verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
            console.log(`New verification code: ${verificationCode}`);
            showModal('success', 'Code Resent', 'A new verification code has been sent to your email.');
            setTimeout(() => showEmailVerification(pendingVerification.email), 1500);
        }

        function verifyEmailCode() {
            const code = ['code1', 'code2', 'code3', 'code4', 'code5', 'code6']
                .map(id => document.getElementById(id).value)
                .join('');
            
            if (code.length !== 6) {
                showModal('error', 'Error', 'Please enter the complete 6-digit code.');
                return;
            }

            if (code === verificationCode) {
                pendingVerification.verified = true;
                showModal('success', 'Email Verified!', 'Your email has been verified successfully!', [
                    {
                        text: 'Continue',
                        class: 'modal-btn-primary',
                        action: () => {
                            closeModal();
                            showDashboard(pendingVerification);
                        }
                    }
                ]);
            } else {
                showModal('error', 'Invalid Code', 'The verification code you entered is incorrect. Please try again.');
            }
        }

        function showTab(tab) {
            const login = document.getElementById('loginForm');
            const signup = document.getElementById('signupForm');
            const loginTab = document.getElementById('loginTab');
            const signupTab = document.getElementById('signupTab');

            login.classList.remove('active');
            signup.classList.remove('active');
            loginTab.classList.remove('active');
            signupTab.classList.remove('active');

            if (tab === 'login') {
                login.classList.add('active');
                loginTab.classList.add('active');
            } else {
                signup.classList.add('active');
                signupTab.classList.add('active');
            }
        }

        function togglePassword(inputId, icon) {
            const input = document.getElementById(inputId);
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        function validatePassword() {
            const password = document.getElementById('signupPassword').value;
            const requirements = document.getElementById('passwordRequirements');
            
            const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
            
            if (password.length > 0 && !passwordRegex.test(password)) {
                requirements.classList.add('show');
            } else {
                requirements.classList.remove('show');
            }
            
            checkPasswordMatch();
        }

        function checkPasswordMatch() {
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const errorDiv = document.getElementById('passwordMatchError');
            const successDiv = document.getElementById('passwordMatchSuccess');
            
            if (confirmPassword.length === 0) {
                errorDiv.classList.remove('show');
                successDiv.classList.remove('show');
                return;
            }
            
            if (password === confirmPassword) {
                errorDiv.classList.remove('show');
                successDiv.classList.add('show');
            } else {
                successDiv.classList.remove('show');
                errorDiv.classList.add('show');
            }
        }

        function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value.trim();
            const password = document.getElementById('loginPassword').value;

            if (!email || !password) {
                showModal('error', 'Missing Information', 'Please fill in all fields');
                return;
            }

            const loginData = {
                email: email,
                password: password
            };

            fetch('login.php', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(loginData)
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    localStorage.setItem('user', JSON.stringify(data.user));
                    showModal('success', 'Success!', 'Login successful!');
                    setTimeout(() => {
                        window.location.reload(); 
                    }, 1000);
                } else {
                    showModal('error', 'Login Failed', data.message || 'Invalid email or password');
                }
            })
            .catch(error => {
                console.error('Login error:', error);
                showModal('error', 'Error', 'Something went wrong. Please try again.');
            });
        }

        function handleSignup(e) {
            e.preventDefault();
    
                const name = document.getElementById('signupName').value.trim();

                
                const validNameRegex = /^[a-zA-Z]+(\s[a-zA-Z]+)*$/;
                if (!validNameRegex.test(name)) {
                    showModal('error', 'Invalid Name', 'Name should contain only letters and spaces (no numbers or special characters)');
                    return;
                }

                if (name.length < 2) {
                    showModal('error', 'Invalid Name', 'Name must be at least 2 characters long');
                    return;
                }

                const email = document.getElementById('signupEmail').value.trim().toLowerCase();
                const password = document.getElementById('signupPassword').value;
                const confirmPassword = document.getElementById('signupConfirmPassword').value;

                if (!name || !email || !password || !confirmPassword) {
                    showModal('error', 'Missing Information', 'Please fill in all fields');
                    return;
                }

                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(email)) {
                    showModal('error', 'Invalid Email', 'Please enter a valid email address');
                    return;
                }

                if (!isEmailValid) {
                    showModal('error', 'Invalid Email', 'Please enter a valid and recognized email address. Check for typos in the domain name.');
                    return;
                }

                const domain = email.split('@')[1];
                if (disposableDomains.some(d => domain.includes(d))) {
                    showModal('error', 'Invalid Email', 'Temporary or disposable email addresses are not allowed. Please use a permanent email address.');
                    return;
                }

                if (password !== confirmPassword) {
                    showModal('error', 'Password Mismatch', 'Passwords do not match');
                    return;
                }

                const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
                if (!passwordRegex.test(password)) {
                    showModal('error', 'Weak Password', 'Password must meet all requirements');
                    return;
                }

                
                const formData = {
                    name: name,
                    email: email,
                    password: password
                };

                fetch('signup.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        localStorage.setItem('user', JSON.stringify({
                            id: data.user.id,
                            name: data.user.name,
                            email: data.user.email
                        }));
                        localStorage.setItem('isNewUser', 'true');
                        
                        showModal('success', 'Account Created!', 'Redirecting to complete your profile...', [
                            {
                                text: 'Continue',
                                class: 'modal-btn-primary',
                                action: () => {
                                    closeModal();
                                    window.location.href = 'questionnaire.html';
                                }
                            }
                        ]);
                    } else {
                        showModal('error', 'Signup Failed', data.message || 'Something went wrong.');
                    }
                })
                .catch(error => {
                    console.error('Signup error:', error);
                    showModal('error', 'Error', 'Something went wrong. Please try again.');
                });
        }

        function showDashboard(userData) {
            currentUser = userData;
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('dashboardContainer').classList.add('active');
            document.getElementById('userName').textContent = currentUser.name;
            document.getElementById('userEmail').textContent = currentUser.email;
            loadPage('home');
        }

        function toggleUserDropdown() {
            document.getElementById('userDropdown').classList.toggle('show');
        }

        function switchPage(page) {
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            event.target.closest('.nav-item')?.classList.add('active');
            loadPage(page);
        }

        function loadPage(page) {
            const contentArea = document.getElementById('contentArea');
            const pages = {
                home: `
                    <div class="page-header">
                        <h1>Welcome to Edu-Gram, ${currentUser.name}! üéâ</h1>
                        <p>Your personalized dashboard to manage your studies effectively.</p>
                    </div>
                    
                    <div class="quote-container">
                        <div class="quote-text"></div>
                        <div class="quote-author"></div>
                        <button class="refresh-quote-btn" onclick="displayQuote()">
                            <i class="fas fa-sync-alt"></i> New Quote
                        </button>
                    </div>

                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <i class="fas fa-tasks"></i>
                            <h3 id="assignmentCount">0</h3>
                            <p>Pending Assignments</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-graduation-cap"></i>
                            <h3 id="examCount">0</h3>
                            <p>Upcoming Exams</p>
                        </div>
                        <div class="stat-card">
                            <i class="fas fa-check-circle"></i>
                            <h3 id="todoCount">0</h3>
                            <p>Tasks To Do</p>
                        </div>
                    </div>
                `,
                assignments: `
                    <div class="page-header">
                        <h1>Assignment Tracker üìù</h1>
                        <p>Manage and track your assignments</p>
                    </div>
                    <button class="btn" style="max-width: 200px; margin-bottom: 20px;" onclick="showAddAssignment()">
                        <i class="fas fa-plus"></i> Add Assignment
                    </button>
                    <div id="assignmentsList" style="display: grid; gap: 15px;"></div>
                `,
                exams: `
                    <div class="page-header">
                        <h1>Exam Tracker üéì</h1>
                        <p>Keep track of your upcoming exams</p>
                    </div>
                    <button class="btn" style="max-width: 200px; margin-bottom: 20px;" onclick="showAddExam()">
                        <i class="fas fa-plus"></i> Add Exam
                    </button>
                    <div id="examsList" style="display: grid; gap: 15px;"></div>
                `,
                pomodoro: `
                    <div class="page-header">
                        <h1>Pomodoro Timer ‚è∞</h1>
                        <p>Boost your productivity with focused study sessions</p>
                    </div>
                    <div style="background: white; padding: 40px; border-radius: 15px; text-align: center; max-width: 500px; margin: 0 auto;">
                        <div style="font-size: 4em; font-weight: bold; color: #0f3460; margin: 30px 0;" id="pomodoroDisplay">25:00</div>
                        <div style="display: flex; gap: 15px; justify-content: center; margin-bottom: 30px;">
                            <button class="btn" style="max-width: 150px;" onclick="startPomodoro()">
                                <i class="fas fa-play"></i> Start
                            </button>
                            <button class="btn" style="max-width: 150px; background: linear-gradient(135deg, #ef4444, #dc2626);" onclick="pausePomodoro()">
                                <i class="fas fa-pause"></i> Pause
                            </button>
                            <button class="btn" style="max-width: 150px; background: linear-gradient(135deg, #64748b, #475569);" onclick="resetPomodoro()">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                        </div>
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button class="tab-btn" onclick="setPomodoroMode('work')" id="workModeBtn">Work (25 min)</button>
                            <button class="tab-btn" onclick="setPomodoroMode('break')" id="breakModeBtn">Break (5 min)</button>
                            <button class="tab-btn" onclick="setPomodoroMode('longbreak')" id="longBreakModeBtn">Long Break (15 min)</button>
                        </div>
                        <div style="margin-top: 30px; font-size: 1.1em; color: #666;" id="pomodoroStatus">Ready to focus! üí™</div>
                    </div>
                `,
                todo: `
                    <div class="page-header">
                        <h1>To-Do List ‚úÖ</h1>
                        <p>Organize your daily tasks</p>
                    </div>
                    <div style="background: white; padding: 30px; border-radius: 15px; max-width: 700px; margin: 0 auto;">
                        <div style="display: flex; gap: 10px; margin-bottom: 20px;">
                            <input type="text" id="todoInput" placeholder="Add a new task..." style="flex: 1; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                            <button class="btn" style="max-width: 150px;" onclick="addTodo()">
                                <i class="fas fa-plus"></i> Add
                            </button>
                        </div>
                        <div id="todoList"></div>
                    </div>
                `,
                techniques: `
                    <div class="page-header">
                        <h1>Study Techniques üí°</h1>
                        <p>Discover effective learning strategies</p>
                    </div>
                    <div style="display: grid; gap: 20px;">
                        <div class="technique-card">
                            <h3><i class="fas fa-brain"></i> Pomodoro Technique</h3>
                            <p>Study for 25 minutes, then take a 5-minute break. After 4 sessions, take a longer 15-30 minute break. This helps maintain focus and prevents burnout.</p>
                        </div>
                        <div class="technique-card">
                            <h3><i class="fas fa-book-open"></i> Active Recall</h3>
                            <p>Instead of passively reading, actively try to remember information. Close your book and write down everything you remember. This strengthens memory retention.</p>
                        </div>
                        <div class="technique-card">
                            <h3><i class="fas fa-repeat"></i> Spaced Repetition</h3>
                            <p>Review material at increasing intervals (1 day, 3 days, 1 week, 2 weeks). This technique uses the spacing effect to improve long-term retention.</p>
                        </div>
                        <div class="technique-card">
                            <h3><i class="fas fa-feather"></i> Feynman Technique</h3>
                            <p>Explain concepts in simple terms as if teaching someone else. If you struggle to explain, you've found gaps in your understanding.</p>
                        </div>
                        <div class="technique-card">
                            <h3><i class="fas fa-sitemap"></i> Mind Mapping</h3>
                            <p>Create visual diagrams connecting related concepts. Start with a central idea and branch out to subtopics, using colors and images to enhance memory.</p>
                        </div>
                        <div class="technique-card">
                            <h3><i class="fas fa-layer-group"></i> Chunking</h3>
                            <p>Break down complex information into smaller, manageable "chunks". Group related items together to make them easier to remember.</p>
                        </div>
                    </div>
                `,
                profile: `
                    <div class="page-header">
                        <h1>Profile üë§</h1>
                    </div>
                    <div id="profileContent" style="background: white; padding: 40px; border-radius: 15px; max-width: 800px; margin: 0 auto; text-align: center;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 3em; color: #0f3460;"></i>
                        <p style="margin-top: 20px; color: #666;">Loading profile...</p>
                    </div>
                `,
                help: `
                    <div class="page-header">
                        <h1>Help & Support üÜò</h1>
                        <p>Get assistance and learn how to use Edu-Gram</p>
                    </div>
                    <div style="display: grid; gap: 20px;">
                        <div class="help-card">
                            <h3><i class="fas fa-question-circle"></i> Getting Started</h3>
                            <p>Welcome to Edu-Gram! Use the sidebar to navigate between different features. Start by adding your assignments and exams to stay organized.</p>
                        </div>
                        <div class="help-card">
                            <h3><i class="fas fa-tasks"></i> Managing Assignments</h3>
                            <p>Click on "Assignments" to add and track your homework. Set due dates and mark them as complete when done.</p>
                        </div>
                        <div class="help-card">
                            <h3><i class="fas fa-clock"></i> Using Pomodoro Timer</h3>
                            <p>The Pomodoro technique helps you focus. Work for 25 minutes, then take a 5-minute break. The timer helps you stay on track.</p>
                        </div>
                        <div class="help-card">
                            <h3><i class="fas fa-envelope"></i> Contact Support</h3>
                            <p>Need more help? Email us at support@edugram.com or visit our FAQ page.</p>
                        </div>
                    </div>
                `
            };
            contentArea.innerHTML = pages[page] || pages.home;
            
            if (page === 'home') {
                displayQuote();
                updateDashboardStats();
            }
            if (page === 'profile') loadProfileData();
            if (page === 'assignments') loadAssignments();
            if (page === 'exams') loadExams();
            if (page === 'todo') loadTodos();
            if (page === 'pomodoro') initPomodoro();

        }

        function updateDashboardStats() {
            fetch('api/get-dashboard-stats.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const assignmentCountEl = document.getElementById('assignmentCount');
                        const examCountEl = document.getElementById('examCount');
                        const todoCountEl = document.getElementById('todoCount');
                        
                        if (assignmentCountEl) {
                            assignmentCountEl.textContent = data.stats.pendingAssignments;
                        }
                        if (examCountEl) {
                            examCountEl.textContent = data.stats.upcomingExams;
                        }
                        if (todoCountEl) {
                            todoCountEl.textContent = data.stats.completedTodos;
                        }
                    } else {
                        console.error('Stats error:', data.message);
                    }
                })
                .catch(error => console.error('Error fetching stats:', error));
        }

        function handleLogout() {
            showModal('warning', 'Confirm Logout', 'Are you sure you want to logout?', [
                {
                    text: 'Cancel',
                    class: 'modal-btn-secondary',
                    action: closeModal
                },
                {
                    text: 'Logout',
                    class: 'modal-btn-danger',
                    action: () => {
                        fetch('api/logout.php')
                            .then(response => response.json())
                            .then(data => {
                               
                                localStorage.removeItem('user');
                                localStorage.removeItem('isNewUser');
                                
                                currentUser = null;
                                closeModal();
                                
                                
                                window.location.href = 'index.html';
                            })
                            .catch(error => {
                                console.error('Logout error:', error);
                                
                                localStorage.clear();
                                window.location.href = 'index.html';
                            });
                    }
                }
            ]);
        }

        window.onload = function() {
            const urlParams = new URLSearchParams(window.location.search);
            const isNewGoogleUser = urlParams.get('newuser');
            
            if (isNewGoogleUser === 'true') {
                
                window.history.replaceState({}, document.title, window.location.pathname);
                
                window.location.href = 'questionnaire.html?google=true';
                return;
            }
            const user = JSON.parse(localStorage.getItem('user'));
            
            if (user) {
                
                showDashboard(user);
            } else {
                
                document.getElementById('loginContainer').classList.add('show');
            }
            
            initGoogleSignIn();
        };

        function checkLoginStatus() {
            fetch('api/check-session.php')
                .then(response => response.json())
                .then(data => {
                    if (data.logged_in) {
                        const user = {
                            name: data.name,
                            email: data.email,
                            verified: true
                        };
                        showDashboard(user);
                    }
                })
                .catch(error => {
                    console.log('Not logged in');
                });
        }

        

        function showAddAssignment() {
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <div class="form-group">
                    <label for="assignmentTitle">Assignment Title</label>
                    <input type="text" id="assignmentTitle" placeholder="e.g., Math Homework" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="form-group">
                    <label for="assignmentSubject">Subject</label>
                    <input type="text" id="assignmentSubject" placeholder="e.g., Mathematics" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="form-group">
                    <label for="assignmentDue">Due Date</label>
                    <input type="date" id="assignmentDue" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" onclick="addAssignment()">Add Assignment</button>
                </div>
            `;
            document.getElementById('modalHeader').className = 'modal-header info';
            document.getElementById('modalIcon').className = 'modal-icon fas fa-tasks';
            document.getElementById('modalTitle').textContent = 'Add Assignment';
            document.getElementById('modalOverlay').classList.add('show');
        }

        function addAssignment() {
            const title = document.getElementById('assignmentTitle').value;
            const subject = document.getElementById('assignmentSubject').value;
            const due = document.getElementById('assignmentDue').value;

            if (!title || !subject || !due) {
                showModal('error', 'Missing Information', 'Please fill in all fields');
                return;
            }

            fetch('api/assignments.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    title: title,
                    subject: subject,
                    due_date: due
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal();
                    loadAssignments();
                    updateDashboardStats();
                    showModal('success', 'Success!', 'Assignment added!');
                }
            });
        }

        function loadAssignments() {
            const container = document.getElementById('assignmentsList');
            if (!container) return;

            fetch('api/assignments.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const assignments = data.assignments;
                        
                        if (assignments.length === 0) {
                            container.innerHTML = '<div style="background: white; padding: 40px; border-radius: 15px; text-align: center; color: #999;">No assignments yet!</div>';
                            return;
                        }

                        container.innerHTML = assignments.map(a => `
                            <div class="assignment-card">
                                <h4>${a.title}</h4>
                                <p><strong>Subject:</strong> ${a.subject}</p>
                                <p><strong>Due:</strong> ${new Date(a.due_date).toLocaleDateString()}</p>
                                <button class="btn" onclick="toggleAssignmentComplete(${a.id}, ${a.completed})">
                                    ${a.completed ? '‚úì Completed' : 'Mark Complete'}
                                </button>
                                <button class="btn" onclick="deleteAssignment(${a.id})">Delete</button>
                            </div>
                        `).join('');
                    }
                });
        }

        function toggleAssignmentComplete(id, currentStatus) {
            fetch('api/assignments.php', {
                method: 'PUT',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    id: id,
                    completed: currentStatus ? 0 : 1
                })
            })
            .then(() => {
                loadAssignments();
                updateDashboardStats();
            });
        }

        function deleteAssignment(id) {
            if (!confirm('Delete this assignment?')) return;
            
            fetch('api/assignments.php', {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: id })
            })
            .then(() => {
                loadAssignments();
                updateDashboardStats();
            });
        }

        

        function showAddExam() {
            const content = document.getElementById('modalContent');
            content.innerHTML = `
                <div class="form-group">
                    <label for="examTitle">Exam Title</label>
                    <input type="text" id="examTitle" placeholder="e.g., Physics Midterm" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="form-group">
                    <label for="examSubject">Subject</label>
                    <input type="text" id="examSubject" placeholder="e.g., Physics" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="form-group">
                    <label for="examDate">Exam Date</label>
                    <input type="date" id="examDate" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="form-group">
                    <label for="examTime">Exam Time</label>
                    <input type="time" id="examTime" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px;">
                </div>
                <div class="modal-buttons">
                    <button class="modal-btn modal-btn-secondary" onclick="closeModal()">Cancel</button>
                    <button class="modal-btn modal-btn-primary" onclick="addExam()">Add Exam</button>
                </div>
            `;
            document.getElementById('modalHeader').className = 'modal-header info';
            document.getElementById('modalIcon').className = 'modal-icon fas fa-graduation-cap';
            document.getElementById('modalTitle').textContent = 'Add Exam';
            document.getElementById('modalOverlay').classList.add('show');
        }

        function addExam() {
            const title = document.getElementById('examTitle').value;
            const subject = document.getElementById('examSubject').value;
            const date = document.getElementById('examDate').value;

            if (!title || !subject || !date) {
                showModal('error', 'Missing Information', 'Please fill in all fields');
                return;
            }

            fetch('api/exams.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    title: title,
                    subject: subject,
                    exam_date: date
                })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    closeModal();
                    loadExams();
                    updateDashboardStats();
                    showModal('success', 'Success!', 'Exam added!');
                }
            });
        }

        function loadExams() {
            const container = document.getElementById('examsList');
            if (!container) return;

            fetch('api/exams.php')  
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const exams = data.exams;
                        
                        if (exams.length === 0) {
                            container.innerHTML = '<div style="background: white; padding: 40px; border-radius: 15px; text-align: center; color: #999;">No exams scheduled!</div>';
                            return;
                        }

                        container.innerHTML = exams.map(e => `
                            <div class="exam-card">
                                <h4>${e.title}</h4>
                                <p><strong>Subject:</strong> ${e.subject}</p>
                                <p><strong>Date:</strong> ${new Date(e.exam_date).toLocaleDateString()}</p>
                                <button class="btn" onclick="deleteExam(${e.id})">Delete</button>
                            </div>
                        `).join('');
                    }
                });
        }

        function deleteExam(id) {
            if (!confirm('Delete this exam?')) return;
            
            fetch('api/exams.php', {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: id })
            })
            .then(() => {
                loadExams();
                updateDashboardStats();
            });
        }

        let pomodoroTimer = null;
        let pomodoroSeconds = 1500;
        let pomodoroMode = 'work';
        let pomodoroRunning = false;

        function initPomodoro() {
            document.getElementById('workModeBtn').classList.add('active');
            updatePomodoroDisplay();
        }

        function startPomodoro() {
            if (pomodoroRunning) return;
            pomodoroRunning = true;
            
            pomodoroTimer = setInterval(() => {
                pomodoroSeconds--;
                updatePomodoroDisplay();
                
                if (pomodoroSeconds <= 0) {
                    clearInterval(pomodoroTimer);
                    pomodoroRunning = false;
                    playNotificationSound();
                    showModal('success', 'Timer Complete!', pomodoroMode === 'work' ? 'Great job! Time for a break.' : 'Break over! Ready to focus again?');
                }
            }, 1000);
            
            document.getElementById('pomodoroStatus').textContent = pomodoroMode === 'work' ? 'Focus time! üéØ' : 'Break time! ‚òï';
        }

        function pausePomodoro() {
            clearInterval(pomodoroTimer);
            pomodoroRunning = false;
            document.getElementById('pomodoroStatus').textContent = 'Paused ‚è∏Ô∏è';
        }

        function resetPomodoro() {
            clearInterval(pomodoroTimer);
            pomodoroRunning = false;
            setPomodoroMode(pomodoroMode);
            document.getElementById('pomodoroStatus').textContent = 'Ready to focus! üí™';
        }

        function setPomodoroMode(mode) {
            pomodoroMode = mode;
            clearInterval(pomodoroTimer);
            pomodoroRunning = false;
            
            document.querySelectorAll('[id$="ModeBtn"]').forEach(btn => btn.classList.remove('active'));
            
            if (mode === 'work') {
                pomodoroSeconds = 1500;
                document.getElementById('workModeBtn').classList.add('active');
            } else if (mode === 'break') {
                pomodoroSeconds = 300;
                document.getElementById('breakModeBtn').classList.add('active');
            } else if (mode === 'longbreak') {
                pomodoroSeconds = 900;
                document.getElementById('longBreakModeBtn').classList.add('active');
            }
            
            updatePomodoroDisplay();
        }

        function updatePomodoroDisplay() {
            const minutes = Math.floor(pomodoroSeconds / 60);
            const seconds = pomodoroSeconds % 60;
            document.getElementById('pomodoroDisplay').textContent = 
                `${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        }

        function playNotificationSound() {
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            oscillator.frequency.value = 800;
            oscillator.type = 'sine';
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.5);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.5);
        }

        

        function addTodo() {
            const input = document.getElementById('todoInput');
            const text = input.value.trim();
            
            if (!text) {
                showModal('error', 'Empty Task', 'Please enter a task');
                return;
            }
            
            fetch('api/todos.php', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ text: text })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    input.value = '';
                    loadTodos();
                    updateDashboardStats();
                }
            });
        }
        function loadTodos() {
            const container = document.getElementById('todoList');
            if (!container) return;
            
            fetch('api/todos.php')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const todos = data.todos;
                        
                        if (todos.length === 0) {
                            container.innerHTML = '<div style="text-align: center; color: #999; padding: 40px;">No tasks yet!</div>';
                            return;
                        }
                        
                        container.innerHTML = todos.map(todo => `
                            <div class="todo-item">
                                <input type="checkbox" class="todo-checkbox">
                                <span class="todo-text">${todo.text}</span>
                                <i class="fas fa-trash todo-delete" onclick="deleteTodo(${todo.id})"></i>
                            </div>
                        `).join('');
                    }
                });
        }

        function toggleTodo(id, currentStatus) {
            const todo = todos.find(t => t.id === id);
            if (todo) todo.completed = !todo.completed;
            loadTodos();
        }

        function deleteTodo(id) {
            if (!confirm('Delete this task?')) return;
            
            fetch('api/todos.php', {
                method: 'DELETE',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id: id })
            })
            .then(() => {
                loadTodos();
                updateDashboardStats();
            });
        }

        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && document.activeElement.id === 'todoInput') {
                addTodo();
            }
        });
        function loadProfileData() {
    const user = JSON.parse(localStorage.getItem('user'));
    
    if (!user || !user.id) {
        console.error('No user data found');
        displayBasicProfile({ name: 'User', email: 'user@email.com' });
        return;
    }

    fetch('api/get_profile.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ user_id: user.id })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success && data.profile) {
            displayProfileData(data.profile);
        } else {
            console.error('Failed to load profile:', data.message);
            displayBasicProfile(user);
        }
    })
    .catch(error => {
        console.error('Error loading profile:', error);
        displayBasicProfile(user);
    });
}

function displayProfileData(profile) {
    const profileHTML = `
        <div class="page-header">
            <h1>Profile üë§</h1>
        </div>
        <div style="background: white; padding: 40px; border-radius: 15px; max-width: 800px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h2 style="margin: 0; color: #0f3460;">${profile.name}</h2>
                <p style="color: #666; margin: 5px 0;">${profile.email}</p>
                <p style="color: #22c55e; margin-top: 10px;">
                    <i class="fas fa-check-circle"></i> Verified
                </p>
            </div>

            <div class="profile-section">
                <h3><i class="fas fa-user-circle"></i> Account Information</h3>
                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <strong><i class="fas fa-signature"></i> Full Name:</strong>
                        <span>${profile.name}</span>
                    </div>
                    <div class="profile-info-item">
                        <strong><i class="fas fa-envelope"></i> Email:</strong>
                        <span>${profile.email}</span>
                    </div>
                    ${profile.member_since ? `
                    <div class="profile-info-item">
                        <strong><i class="fas fa-calendar-alt"></i> Member Since:</strong>
                        <span>${new Date(profile.member_since).toLocaleDateString('en-US', { 
                            year: 'numeric', month: 'long', day: 'numeric' 
                        })}</span>
                    </div>
                    ` : ''}
                </div>
            </div>

            ${profile.questionnaire_completed ? `
            <div class="profile-section">
                <h3><i class="fas fa-graduation-cap"></i> Academic Information</h3>
                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <strong><i class="fas fa-school"></i> Education Level:</strong>
                        <span>${formatEducationLevel(profile.education_level)}</span>
                    </div>
                    <div class="profile-info-item">
                        <strong><i class="fas fa-calendar-check"></i> Current Year:</strong>
                        <span>Year ${profile.current_year}</span>
                    </div>
                    <div class="profile-info-item">
                        <strong><i class="fas fa-book"></i> Major Subject:</strong>
                        <span>${profile.major_subject}</span>
                    </div>
                    <div class="profile-info-item">
                        <strong><i class="fas fa-clock"></i> Study Hours (Daily):</strong>
                        <span>${formatStudyHours(profile.study_hours_daily)}</span>
                    </div>
                </div>
            </div>

            <div class="profile-section">
                <h3><i class="fas fa-bullseye"></i> Goals & Challenges</h3>
                <div class="profile-info-grid">
                    <div class="profile-text-area">
                        <strong><i class="fas fa-target"></i> Academic Goals:</strong>
                        <p>${profile.goals || 'Not specified'}</p>
                    </div>
                    <div class="profile-text-area">
                        <strong><i class="fas fa-exclamation-triangle"></i> Challenges:</strong>
                        <p>${profile.challenges || 'None specified'}</p>
                    </div>
                </div>
            </div>

            <div class="edit-profile-btn">
                <button class="btn" onclick="goToQuestionnaire()" style="max-width: 200px;">
                    <i class="fas fa-edit"></i> Edit Profile
                </button>
            </div>
            ` : `
            <div class="profile-section">
                <div class="questionnaire-prompt">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>Complete Your Profile</h3>
                    <p>Complete the questionnaire to add more details to your profile.</p>
                    <button class="btn" onclick="goToQuestionnaire()" style="max-width: 250px;">
                        <i class="fas fa-pencil-alt"></i> Complete Questionnaire
                    </button>
                </div>
            </div>
            `}
        </div>
    `;

    document.getElementById('contentArea').innerHTML = profileHTML;
}

function displayBasicProfile(user) {
    const profileHTML = `
        <div class="page-header">
            <h1>Profile üë§</h1>
        </div>
        <div style="background: white; padding: 40px; border-radius: 15px; max-width: 600px; margin: 0 auto;">
            <div style="text-align: center; margin-bottom: 30px;">
                <div class="profile-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <h2 style="margin: 0; color: #0f3460;">${user.name}</h2>
                <p style="color: #666; margin: 5px 0;">${user.email}</p>
                <p style="color: #22c55e; margin-top: 10px;">
                    <i class="fas fa-check-circle"></i> Verified
                </p>
            </div>
            <div class="profile-section">
                <h3>Account Information</h3>
                <div class="profile-info-grid">
                    <div class="profile-info-item">
                        <strong>Full Name:</strong> <span>${user.name}</span>
                    </div>
                    <div class="profile-info-item">
                        <strong>Email:</strong> <span>${user.email}</span>
                    </div>
                </div>
            </div>
            <div class="profile-section">
                <div class="questionnaire-prompt">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>Complete Your Profile</h3>
                    <p>Complete the questionnaire to add more details to your profile.</p>
                    <button class="btn" onclick="goToQuestionnaire()" style="max-width: 250px;">
                        <i class="fas fa-pencil-alt"></i> Complete Questionnaire
                    </button>
                </div>
            </div>
        </div>
    `;
    
    document.getElementById('contentArea').innerHTML = profileHTML;
}

    function formatEducationLevel(level) {
        const levels = {
            'school': 'School',
            'high_school': 'High School',
            'bachelor': "Bachelor's Degree",
            'masters': "Master's Degree",
            'other': 'Other'
        };
        return levels[level] || level;
    }

    function formatStudyHours(hours) {
        if (hours == 1) return '1-2 hours';
        if (hours == 3) return '3-4 hours';
        if (hours == 5) return '5-6 hours';
        if (hours >= 7) return '7+ hours';
        return `${hours} hours`;
    }

    
    function goToQuestionnaire() {

        localStorage.setItem('editingProfile', 'true');
        window.location.href = 'questionnaire.html';
    }

    
    function editProfile() {
        goToQuestionnaire();
    }


    </script>
    
        <button class="chatbot-toggler" onclick="toggleChatbot()">
            <span class="material-icons">chat</span>
        </button>

        <div class="chatbot-container" id="chatbot">
            <div class="chatbot-header">
                <h2>Virtual Assistant</h2> 
                <span class="close-btn" onclick="toggleChatbot()">&times;</span>
            </div>
            
            <ul class="chat-box">
                <li class="chat incoming">
                    <span class="material-icons">smart_toy</span>
                    <p>Helloüëã! I am your AI assistant. Ask me anything.</p>
                </li>
            </ul>

            <div class="chat-input">
                <textarea placeholder="Type a message..." required></textarea>
                <span id="send-btn" class="material-icons">send</span>
            </div>
        </div>

        <script src="aichatbot.js"></script>
</body>
</html>